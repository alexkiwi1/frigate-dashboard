<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Dashboard Timezone</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Debug Dashboard Timezone Issue</h1>
    
    <div class="debug-section">
        <h3>1. Test Timezone Conversion</h3>
        <div id="timezone-test">Loading...</div>
    </div>

    <div class="debug-section">
        <h3>2. Test API Response</h3>
        <div id="api-test">Loading...</div>
    </div>

    <div class="debug-section">
        <h3>3. Test Dashboard Response</h3>
        <div id="dashboard-test">Loading...</div>
    </div>

    <div class="debug-section">
        <h3>4. Manual Timezone Test</h3>
        <p>Try changing the timezone below and see the result:</p>
        <select id="timezone-select">
            <option value="PKT">PKT (Asia/Karachi)</option>
            <option value="EST">EST (America/New_York)</option>
            <option value="UTC">UTC</option>
        </select>
        <button onclick="testTimezone()">Test Timezone</button>
        <div id="manual-test-result"></div>
    </div>

    <script>
        // Test 1: Basic timezone conversion
        const testDate = "2025-10-20T07:57:40.289+00:00";
        const date = new Date(testDate);
        
        document.getElementById('timezone-test').innerHTML = `
            <p><strong>Input:</strong> ${testDate}</p>
            <p><strong>UTC:</strong> ${date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'UTC' })}</p>
            <p><strong>PKT:</strong> ${date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'Asia/Karachi' })}</p>
            <p class="success">✅ Timezone conversion is working correctly</p>
        `;

        // Test 2: API response
        fetch('/api/employees/work-hours?start_date=2025-10-20&end_date=2025-10-20&timezone=PKT')
            .then(response => response.json())
            .then(data => {
                if (data.employees && data.employees.length > 0) {
                    const employee = data.employees[0];
                    const arrivalTime = employee.arrival_time;
                    const utcTime = new Date(arrivalTime).toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: false,
                        timeZone: 'UTC'
                    });
                    const pktTime = new Date(arrivalTime).toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: false,
                        timeZone: 'Asia/Karachi'
                    });
                    
                    document.getElementById('api-test').innerHTML = `
                        <p><strong>API Response:</strong> ${arrivalTime}</p>
                        <p><strong>UTC Time:</strong> ${utcTime}</p>
                        <p><strong>PKT Time:</strong> ${pktTime}</p>
                        <p class="success">✅ API data conversion is working</p>
                    `;
                } else {
                    document.getElementById('api-test').innerHTML = '<p class="error">❌ No employee data found</p>';
                }
            })
            .catch(error => {
                document.getElementById('api-test').innerHTML = `<p class="error">❌ API Error: ${error.message}</p>`;
            });

        // Test 3: Dashboard response
        fetch('/')
            .then(response => response.text())
            .then(html => {
                document.getElementById('dashboard-test').innerHTML = `
                    <p><strong>Dashboard Status:</strong> ${html.includes('Time & Activity Report') ? '✅ Running' : '❌ Not found'}</p>
                    <p><strong>Response Length:</strong> ${html.length} characters</p>
                    <p class="info">Dashboard is accessible and responding</p>
                `;
            })
            .catch(error => {
                document.getElementById('dashboard-test').innerHTML = `<p class="error">❌ Dashboard Error: ${error.message}</p>`;
            });

        // Test 4: Manual timezone test
        function testTimezone() {
            const timezone = document.getElementById('timezone-select').value;
            const timezoneMap = {
                'PKT': 'Asia/Karachi',
                'EST': 'America/New_York',
                'UTC': 'UTC'
            };
            
            const testDate = "2025-10-20T07:57:40.289+00:00";
            const date = new Date(testDate);
            const convertedTime = date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false,
                timeZone: timezoneMap[timezone]
            });
            
            document.getElementById('manual-test-result').innerHTML = `
                <p><strong>Selected Timezone:</strong> ${timezone} (${timezoneMap[timezone]})</p>
                <p><strong>Converted Time:</strong> ${convertedTime}</p>
                <p class="success">✅ Manual timezone conversion working</p>
            `;
        }

        // Initial test
        testTimezone();
    </script>
</body>
</html>
