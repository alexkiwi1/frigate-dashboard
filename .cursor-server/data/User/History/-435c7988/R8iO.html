<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Timezone Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .result { font-weight: bold; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Dashboard Timezone Test</h1>
    
    <div class="test-section">
        <h3>Current Dashboard Status</h3>
        <p>Let me check what the dashboard is actually showing...</p>
        <div id="dashboard-status">Loading...</div>
    </div>

    <div class="test-section">
        <h3>API Data Test</h3>
        <div id="api-test">Loading...</div>
    </div>

    <div class="test-section">
        <h3>Timezone Conversion Test</h3>
        <div id="timezone-test">Loading...</div>
    </div>

    <script>
        // Test timezone conversion
        const testDate = "2025-10-20T07:57:40.289+00:00";
        const date = new Date(testDate);
        
        const timezoneTest = document.getElementById('timezone-test');
        timezoneTest.innerHTML = `
            <p><strong>Input:</strong> ${testDate}</p>
            <p><strong>UTC Time:</strong> ${date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'UTC' })}</p>
            <p><strong>PKT Time:</strong> ${date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone: 'Asia/Karachi' })}</p>
            <p class="success">✅ Timezone conversion is working correctly (07:57 UTC → 12:57 PKT)</p>
        `;

        // Test API data
        fetch('/api/employees/work-hours?start_date=2025-10-20&end_date=2025-10-20&timezone=PKT')
            .then(response => response.json())
            .then(data => {
                const apiTest = document.getElementById('api-test');
                if (data.employees && data.employees.length > 0) {
                    const firstEmployee = data.employees[0];
                    const arrivalTime = firstEmployee.arrival_time;
                    const convertedTime = new Date(arrivalTime).toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: false,
                        timeZone: 'Asia/Karachi'
                    });
                    
                    apiTest.innerHTML = `
                        <p><strong>API Response:</strong> ${arrivalTime}</p>
                        <p><strong>Converted to PKT:</strong> ${convertedTime}</p>
                        <p class="success">✅ API data conversion is working correctly</p>
                    `;
                } else {
                    apiTest.innerHTML = '<p class="error">❌ No employee data found</p>';
                }
            })
            .catch(error => {
                document.getElementById('api-test').innerHTML = `<p class="error">❌ API Error: ${error.message}</p>`;
            });

        // Check dashboard status
        fetch('/')
            .then(response => response.text())
            .then(html => {
                const dashboardStatus = document.getElementById('dashboard-status');
                if (html.includes('Time & Activity Report')) {
                    dashboardStatus.innerHTML = '<p class="success">✅ Dashboard is running and showing Time & Activity Report</p>';
                } else {
                    dashboardStatus.innerHTML = '<p class="error">❌ Dashboard not found or not showing expected content</p>';
                }
            })
            .catch(error => {
                document.getElementById('dashboard-status').innerHTML = `<p class="error">❌ Dashboard Error: ${error.message}</p>`;
            });
    </script>
</body>
</html>
